#!/bin/sh

# (C) Copyright 2012-2013 Altair Engineering, Inc.  All rights reserved.
# This code is provided "as is" without any warranty, express or implied, or
# indemnification of any kind.  All other terms and conditions are as
# specified in the Altair PBS EULA.

# Assumption:
# This wrapper script assumes
#  1) PBS Server/Scheduler is running on the CMU Management Node, which 
#     maybe be on the same host OR on the HPE SGI Admin node (defined
#     by PBS_SERVER.
#  2) Script is executed on the CMU Management Node.

# Purpose:
# This wrapper script is used to start or stop the PBS Server/Scheduler
# daemon on the CMU Management node.

# Source in PBS specific environment variables from pbs.conf
if [ -f /etc/pbs.conf ]; then
    . /etc/pbs.conf
else
    echo "Unable to find /etc/pbs.conf"
    exit 1
fi

# Define CMU_PATH
CMU_PATH=/opt/cmu/bin

# Simple Usage statement
Usage() {
    cat <<EOF
Usage: `basename $0`

nodelist can be a space-separated list or a file

EOF
    exit 0
}

while getopts c:hu opt; do
    case $opt in
        h|u) Usage ;;
    esac
done

node=`hostname`

# If node is PBS_SERVER proceed with case statement logic
# If node is _not_ the PBS_SERVER then echo simple error message
if [ "${node}" == "${PBS_SERVER}" ]; then
    case `basename $0` in
        *stop)       /etc/init.d/pbs stop ;;
        *restart)    /etc/init.d/pbs restart ;;
        *start)      /etc/init.d/pbs start ;;
    esac
else
    case `basename $0` in
        *stop)       echo "Stopping PBS Server/Scheduler on ${PBS_SERVER}"
                     ssh ${PBS_SERVER} /etc/init.d/pbs stop ;;
        *restart)    echo "Restart PBS Server/Scheduler on ${PBS_SERVER}"
                     ssh ${PBS_SERVER} /etc/init.d/pbs restart ;;
        *start)      echo "Starting PBS Server/Scheduler on ${PBS_SERVER}"
                     ssh ${PBS_SERVER} /etc/init.d/pbs start ;;
    esac
fi
